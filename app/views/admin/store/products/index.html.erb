<div class="pull-right">
    <%= link_to "new product", new_admin_store_product_path, class: 'btn btn-sm btn-default' %>
    <%= link_to "setup categories", admin_system_categories_path(type: :product), class: 'btn btn-sm btn-default' %>
    <%= link_to "adjust_prices", admin_store_products_adjust_prices_path, class: 'btn btn-sm btn-default' %>
</div>

<h2><i class="fa fa-tags"></i>&nbsp; Products</h2>

<%= render "admin/shared/search_results_header", object: @products %>

<% unless params[:q] %>
  <select name="product_type" class="pull-right product-status">
    <option value="active">Active Products</option>
    <option value="all" <%= "selected" if params[:product_type] == "all" %>>All Products</option>
  </select>
<% end %>

<%= will_paginate @products %>
<table class="table table-striped table-condensed">
	<tr>
		<th>Item</th>
    <th>Brand</th>
		<th>Title</th>
		<th>Status</th>
		<th class="ralign">Price</th>
    <th class="calign">Sold</td>
		<th class="actions">&nbsp;</th>
	</tr>
	<% @products.each do |product|
   order_count = @sold.find { |x| x[0] == product.id }  %>
	<tr>
		<td><%= link_to product.sku, admin_store_product_path(product) %></td>
    <td><%= product.brand %></td>
		<td><%= product.title %></td>
    <td><%= product_status(product) %></td>
		<td class="ralign">$<%= product.price %></td>
    <td class="calign"><%= order_count.nil? ? 0 : number_with_delimiter(order_count[1]) %></td>
		<td class="actions ralign">
			<%= link_to "edit", edit_admin_store_product_path(product) %> &nbsp;
			<%= link_to "delete", 
						  { action: "destroy", id: product.id }, 
						  method: :delete, 
						  data: { confirm: "Are you sure?" } %>
		</td>
	</tr>
	<% end %>
</table>

<div class="table-summary">
	<%= number_with_delimiter(@products.total_entries) %> records
</div>


<% content_for :title do %>
	Products
<% end %>

<% content_for :head do %>
  <script>
    $(document).ready(function() {
      $(".product-status").change(function() {
        window.location = "/admin/store/products?product_type=" + $(this).val();
      });
    });
  </script>
<% end %>


<% content_for :breadcrumbs do %>
	<li><a href="#">eCommerce</a></li>
	<li class="active">Products</li>
<% end %>
