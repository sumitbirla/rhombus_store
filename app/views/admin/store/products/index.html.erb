<div class="pull-right">
    <%= link_to new_admin_store_product_path, class: 'btn btn-sm btn-default' do %>
      <i class="fa fa-plus"></i> New product
    <% end %>
    <%= link_to admin_system_categories_path(type: :product), class: 'btn btn-sm btn-default'  do %>
      <i class="fa fa-list-ul"></i> Setup categories
    <% end %>
    <%= link_to admin_store_products_adjust_prices_path, class: 'btn btn-sm btn-default' do %>
      <i class="fa fa-dollar"></i> Adjust prices
    <% end %>
</div>

<h2><i class="fa fa-tags"></i>&nbsp; Products</h2>

<%= render "admin/shared/search_results_header", object: @products %>

<% unless params[:q] %>
<div class="pull-right" style="margin-bottom: 12px;">
  <select name="brand_id" class="brand">
    <option value="">-- white label --</option>
    <option value="all">-- all brands --</option>
    <% Brand.where(id: Product.select(:brand_id).uniq.pluck(:brand_id)).order(:name).each do |b| %>
      <option value="<%= b.id %>" <%= "selected" if params[:brand_id] == b.id.to_s %>><%= b.name %></option>
    <% end %>
  </select>
  <select name="product_type" class="product-type">
    <option value="active">Active Products</option>
    <option value="all" <%= "selected" if params[:product_type] == "all" %>>All Products</option>
  </select>
</div>
<% end %>

<%= will_paginate @products %>
<table class="table table-striped table-condensed footable">
	<tr>
		<th data-breakpoints="xs"><%= sortable "item_number", "Item" %></th>
    <th data-breakpoints="xs"><%= sortable "store_brands.name", "Brand" %></th>
		<th><%= sortable "title" %></th>
    <th data-breakpoints="xs"><%= sortable "product_type", "Type" %></th>
		<th><%= sortable "active", "Status" %></th>
		<th data-breakpoints="xs" class="ralign"><%= sortable "msrp", "MSRP" %></th>
		<th class="actions hidden-xs">&nbsp;</th>
	</tr>
	<% @products.each do |product| %>
	<tr>
		<td><%= link_to product.item_number, admin_store_product_path(product) %></td>
    <td><%= product.brand || "<span class='light'>- generic -</span>".html_safe %></td>
		<td><%= product.name_with_option %></td>
    <td><%= product.product_type %></td>
    <td><%= product_status(product) %></td>
		<td class="ralign"><%= number_to_currency product.msrp %></td>
		<td class="actions text-right hidden-xs">
			<%= link_to "edit", edit_admin_store_product_path(product) %> &nbsp;
			<%= link_to "delete", 
						  { action: "destroy", id: product.id }, 
						  method: :delete, 
						  data: { confirm: "Are you sure?" } %>
		</td>
	</tr>
	<% end %>
</table>

<%= render 'admin/shared/table_summary', data: @products %>


<% content_for :title do %>
	Products
<% end %>

<% content_for :head do %>
  <script>
    $(document).ready(function() {
      $(".brand, .product-type").change(function() {
        window.location = "/admin/store/products?product_type=" + $(".product-type").val() + "&brand_id=" + $(".brand").val();
      });
    });
  </script>
<% end %>


<% content_for :breadcrumbs do %>
	<li><a href="#">eCommerce</a></li>
	<li class="active">Products</li>
<% end %>
