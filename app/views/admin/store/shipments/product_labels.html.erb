<h2>Shipment Labels</h2>

<% 
  shipment_ids = @shipment_items.collect { |x| x.shipment_id }.uniq 
  shipments = Shipment.where(id: shipment_ids)
%>
<div>
  For Shipments: <% shipment_ids.each do |x| %>
    <% shp = shipments.find { |s| s.id == x }%>
    <%= link_to shp.to_s, admin_store_shipment_path(shp) %> <span class="light">/</span> 
  <% end %>
</div>


  <%
    prev_label_id = -1
    @shipment_items.each do |item|
    unless item.product.label_sheet_id == prev_label_id
      prev_label_id = item.product.label_sheet_id %>
      </table>
      <h3><%= item.product.label_sheet || "- not set -" %></h3>
      <table id="item-table" class="table table-striped table-condensed tablesorter">
        <tr>
          <th class="col-md-3">Item</th>
          <th class="col-md-6">Description</th>
          <th class="col-md-2 calign">Quantity</th>
          <th class="col-md-1 actions">&nbsp;</th>
        </tr> 
    <% end %>
  <%
        dir = item.order_item.item_id.split('-')[1]
        pdf_path = "/userfiles/images/labels/#{dir}/#{item.order_item.item_id}.pdf"
  %>
      <tr>
        <td><%= item.order_item.item_id.upcase %></td>
        <td><%= item.product.name_with_option %></td>
        <td class="calign"><%= item.quantity %></td>
        <td class="actions">
          <%= link_to Cache.setting('System', 'Static Files Url') + pdf_path, target: '_blank' do %>
              <i class="fa fa-download"></i> pdf
          <% end %>
        </td>
      </tr>
  <% end %>

</table>



<%= content_for :title do %>
    Shipment: Product Labels
<% end %>


<% content_for :head do %>
  <link href="/rhombus_store/tablesorter.css" rel="stylesheet">
  <script src="/rhombus_store/jquery.tablesorter.min.js"></script> 

  <script>
    $(document).ready(function() {
      $("#item-table").tablesorter(); 
    });
  </script>

<% end %>



<% content_for :breadcrumbs do %>
    <li><a href="#">eCommerce</a></li>
    <li><%= link_to 'Shipments', admin_store_shipments_path %></li>
    <li class="active">Product Labels</li>
<% end %>

