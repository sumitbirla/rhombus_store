<h2>Shipment Labels</h2>

<% 
  shipment_ids = @shipment_items.collect { |x| x.shipment_id }.uniq 
  shipments = Shipment.where(id: shipment_ids)
%>
<div class="pull-right">
  <a href="#" class="zero-counts btn btn-sm btn-default"><i class="fa fa-dot-circle-o"></i> Zero Counts</a>
</div>

<div>
  For Shipments: <% shipment_ids.each do |x| %>
    <% shp = shipments.find { |s| s.id == x }%>
    <%= link_to shp.to_s, admin_store_shipment_path(shp) %> <span class="light">/</span> 
  <% end %>
</div>


  <%
    prev_label_id = -1
    @shipment_items.each do |item|
    unless item.product.label_sheet_id == prev_label_id
      prev_label_id = item.product.label_sheet_id %>
      </table>
      </form>
      <form action="" method="post">
        <input type="hidden" name="label" value="<%= item.product.label_sheet %>">
      <h3>  
        <%= item.product.label_sheet || "- not set -" %>  &nbsp; 
        <button class="btn btn-xs btn-default"><i class="fa fa-print"></i> print</button>
      </h3>
      <table id="item-table" class="table table-striped table-condensed tablesorter">
        <tr>
          <th class="col-md-2">Item</th>
          <th class="col-md-5">Description</th>
          <th class="col-md-2 calign">Quantity</th>
          <th class="col-md-1 calign">Print</th>
          <th class="col-md-1 calign">&nbsp;</th>
          <th class="col-md-1 calign">&nbsp;</th>
        </tr> 
    <% end %>
  <%
        dir = item.order_item.item_id.split('-')[1]
        pdf_path = "/userfiles/images/labels/#{dir}/#{item.order_item.item_id}.pdf"
  %>
      <tr>
        <td><%= item.order_item.item_id.upcase %></td>
        <td><%= item.product.name_with_option %></td>
        <td class="calign"><%= item.quantity %></td>
        <td class="calign">
          <input style="width: 60px; text-align: center;" type="numeric" name="item-<%= item.order_item.item_id %>" value="<%= item.quantity %>">
        </td>
        <td class="calign"><a class="print-single" href="#"><i class="fa fa-print"></i> print</a></td>
        <td class="calign"> 
          <%= link_to Cache.setting('System', 'Static Files Url') + pdf_path, target: '_blank' do %>
              <i class="fa fa-file-pdf-o"></i> pdf
          <% end %>
        </td>
      </tr>
  <% end %>

</table>
</form>



<%= content_for :title do %>
    Shipment: Product Labels
<% end %>


<% content_for :head do %>
  <link href="/rhombus_store/tablesorter.css" rel="stylesheet">
  <script src="/rhombus_store/jquery.tablesorter.min.js"></script> 

  <script>
    $(document).ready(function() {
      
      $(".zero-counts").click(function() {
        $("input[type='numeric']").val("0");
      });
      
      $(".print-single").click(function() {
        var qty = $(this).parent().prev().find("input[type='numeric']").val();
        $(this).parent().parent().parent().find("input[type='numeric']").val("0");
        $(this).parent().prev().find("input[type='numeric']").val(qty);
        $(this).parents("form").submit();
      }); 
      
    });
  </script>

<% end %>



<% content_for :breadcrumbs do %>
    <li><a href="#">eCommerce</a></li>
    <li><%= link_to 'Shipments', admin_store_shipments_path %></li>
    <li class="active">Product Labels</li>
<% end %>

