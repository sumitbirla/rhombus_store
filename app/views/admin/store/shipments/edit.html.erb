<h2>Shipment #<%= @shipment.order_id %>-<%= @shipment.sequence %></h2>

<%= render 'admin/shared/error_messages', object: @shipment %>

<%= simple_form_for [:admin, :store, @shipment], html: { class: 'form-inline', style: 'margin-left: 0' } do |f| %>
    <%= f.hidden_field :order_id %>
    <%= f.hidden_field :sequence %>
    <%= f.hidden_field :status %>

    <table class="table table-striped table-condensed table-bordered">
      <tr>
        <th>Item</th>
        <th>Description</th>
        <th class="calign">Ordered</th>
        <th class="calign">Ship Qty</th>
        <th class="calign">Special Status</th>
      </tr>
      <%= f.fields_for :items do |itemf| %>
        <% 
          sitem = @shipment.items[itemf.index] 
          oitem = OrderItem.find(sitem.order_item_id)
        %>
          <tr>
            <td nowrap><%= itemf.hidden_field :order_item_id %><%= oitem.item_id.upcase %></td>
            <td><%= render oitem %></td>
            <td class="calign"><%= oitem.quantity %></td>
            <td class="calign"><%= itemf.number_field :quantity, unit_price: oitem.unit_price, class: "item-qty", style: 'width: 80px; text-align: center;' %></td>
            <td class="calign"><%= itemf.text_field :special_status %></td>
          </tr>
      <% end %>
    </table>


    <div class="row">

      <div class="col-md-6">
        <div class="panel panel-primary">
          <div class="panel-heading">Ship From:</div>
          <div class="panel-body">
            <%= f.input :ship_from_company, label: 'Company' %>
            <%= f.input :ship_from_street1, label: 'Street 1' %>
            <%= f.input :ship_from_street2, label: 'Street 2' %>
            <%= f.input :ship_from_city, label: 'City' %>
            <%= f.input :ship_from_state, label: 'State' %>
            <%= f.input :ship_from_zip, label: 'Zipcode' %>
            <%= f.input :ship_from_country, label: 'Country' %>
          </div>
        </div>

        <div class="panel panel-primary">
          <div class="panel-heading">Shipper Contact:</div>
          <div class="panel-body">
            <%= f.input :ship_from_email, label: 'Email' %>
            <%= f.input :ship_from_phone, label: 'Phone' %>
            <%= f.input :notes, input_html: { class: '', rows: 2 } %>
          </div>
        </div>
        
        <div class="panel panel-success">
          <div class="panel-heading"><%= link_to "update", "#", class: 'update-invoice pull-right' %>Invoice</div>
          <div class="panel-body">
            <%= f.input :invoice_amount%>
          </div>
        </div>

      </div>

      <div class="col-md-6">
        
		<div class="panel panel-primary">
          <div class="panel-heading">Recipient Address:</div>
          <div class="panel-body">
            <%= f.input :recipient_name, label: 'Recipient' %>
            <%= f.input :recipient_company, label: 'Company' %>
            <%= f.input :recipient_street1, label: 'Street 1' %>
            <%= f.input :recipient_street2, label: 'Street 2' %>
            <%= f.input :recipient_city, label: 'City' %>
            <%= f.input :recipient_state, label: 'State' %>
            <%= f.input :recipient_zip, label: 'Zipcode' %>
            <%= f.input :recipient_country, label: 'Country' %>
          </div>
        </div>
      	
        <div class="panel panel-success">
          <div class="panel-heading">Shipment Details:</div>
          <div class="panel-body">
            <%= f.input :carrier, collection: ["USPS", "FedEx", "UPS"] %>
            <%= f.input :ship_method %>
            <div class="form-group string optional ship_date">
              <label class="string required control-label">Ship Date</label>
              <div class="input-group date date-field">
                <%= f.input_field :ship_date, as: :string, class: "form-control" %>
                <span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
              </div>
            </div>
            <%= f.input :ship_cost %>
            <%= f.input :tracking_number %>
            <%= f.input :status, collection: ['pending', 'shipped', 'void', 'cancelled', 'delivered'] %>
          </div>
        </div>
	  
	  </div>

    </div>

    <%= f.button :submit, class: 'btn-primary' %>

<% end %>



<%= content_for :title do %>
    Shipment <%= @shipment.order_id %>-<%= @shipment.sequence %>
<% end %>


<% content_for :head do %>
    <style>
        .form-inline .form-group { margin: 10px 0; }
    </style>
    
    <script>
      $(document).ready(function() {
        
        $(".update-invoice").click(function(e) {
          
          e.preventDefault();
          var total = 0.0;
      
          $(".item-qty").each(function() {  
              var unit_price = parseFloat($(this).attr("unit_price"));
              var quantity = parseFloat($(this).val());
        
              if (!isNaN(unit_price) && !isNaN(quantity))
                total += unit_price * quantity; 
          });
      
          $("#shipment_invoice_amount").val(total.toFixed(2));
        });
        
      });
    </script>
<% end %>


<% content_for :breadcrumbs do %>
    <li><a href="#">eCommerce</a></li>
    <li><%= link_to 'Orders', admin_store_orders_path %></li>
    <li><%= link_to '#' + @shipment.order_id.to_s, admin_store_order_path(@shipment.order_id)%></li>
	<% unless @shipment.id.nil? %>
    <li><%= link_to "Shipment " + @shipment.to_s, admin_store_shipment_path(@shipment.id)%></li>
    <li class="active">edit</li>
	<% else %>
		<li class="active">new</li>
	<% end %>
<% end %>
