<%
  status_list = PurchaseOrder.uniq(:status).order(status: :desc).pluck(:status)
  status_list = status_list
%>

<div class="pull-right">
  <select id="selAction" class="form-control" style="display: inline; width: 75%">
    <option> - - Select Action - - </option>
	  <option method="get" value="<%= new_admin_inventory_purchase_order_path %>">New purchase order</option>
    <optgroup label="Change order status to ">
      <option method="post" value="/admin/inventory/purchase_orders_update_status?status=new">New</option>
      <option method="post" value="/admin/inventory/purchase_orders_update_status?status=released">Released</option>
      <option method="post" value="/admin/inventory/purchase_orders_update_status?status=cancelled">Cancelled</option>
      <option method="post" value="/admin/inventory/purchase_orders_update_status?status=received">Received</option>
      <option method="post" value="/admin/inventory/purchase_orders_update_status?status=closed">Closed</option>
    </optgroup>
  </select>
  <input type="button" class="btn btn-default btn-small" id="btnAction" value="Go" />	  
</div>

<h2><i class="fa fa-file-text-o"></i>&nbsp; Purchase Orders</h2>

<%= render "admin/shared/search_results_header", object: @purchase_orders %>

<% if params[:q].nil? %>
<ul class="nav nav-tabs" style="margin-bottom: 10px;">
  <% status_list.each do |status|
      count = PurchaseOrder.where(status: status).count %>
  <li class="<%= "active" if params[:status] == status %>"><a href="<%= admin_inventory_purchase_orders_path(status: status)%>"><%= tab_count(status.titlecase, count) %></a></li>
  <% end %>
  <li class="<%= "active" if params[:status].blank? %>"><a href="<%= admin_inventory_purchase_orders_path %>">All</a></li>
</ul>
<% end %>

<% if @purchase_orders.length == 0 %>
  <div class="alert alert-warning">There are no purchase orders with status '<b><%= params[:status] %></b>'</div>
<% end %>

<form id="frmBatch" action="" method="post">
	<%= token_tag %>

<%= will_paginate @purchase_orders %>
<table class="table table-striped table-condensed">
	<tr>
    <th><input type="checkbox" id="chkAll" /></th>
		<th><%= sortable "id", "PO #" %></th>
		<th><%= sortable "core_affiliates.name", "Supplier" %></th>
		<th class="text-center"><%= sortable "issue_date" %></th>
		<th class="text-center"><%= sortable "due_date" %></th>
    <th class="text-center">Received</th>
		<th class="text-right">Amount</th>
		<th class="text-center">Status</th>
		<th></th>
	</tr>
	<%= render @purchase_orders %>
</table>

</form>

<%= render 'admin/shared/table_summary', data: @purchase_orders %>


<% content_for :title do %>
	Purchase Orders
<% end %>


<% content_for :breadcrumbs do %>
	<li><a href="#">Inventory</a></li>
	<li class="active">Purchase Orders</li>
<% end %>


<% content_for :head do %>

	<script type="text/javascript">
	    $(document).ready(function () {

	        $("#btnAction").click(function () {
	            $("#frmBatch").attr("action", $("#selAction").val());
	            $("#frmBatch").attr("method", $("#selAction option:selected").attr("method"));
	            $("#frmBatch").submit();
	        });

          $("#chkAll").change(function() {

            if ($(this).prop("checked"))
              $(".po-chk").prop("checked", true);
            else
              $(".po-chk").prop("checked", false);
          });

	    });
    </script>

<% end %>
